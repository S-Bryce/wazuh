<!--
  -  Microsoft Graph rules - Security resource
  -  Created by Bryce Shurts & Swaroopa Allaparti & Emiliano Garcia
  -  Copyright (C) 2023, InfoDefense Inc.
  -  This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2.
-->

<!--
    ID range: 99000 - 99500
-->

<group name="ms-graph">
    <!--Add catchall rule -->
    <rule id="99000" level="0">
        <decoded_as>json</decoded_as>
        <field name="integration">ms-graph</field>
        <options>no_full_log</options>
        <description>MS Graph message: Microsoft graph messages grouped.</description>
    </rule>


<!--Alerts&Incidents 99001-99200-->

    <rule id="99001" level="3">
        <if_sid>99000</if_sid>
        <options>no_full_log</options>
        <field name="relationship">alerts|alerts_v2</field>
        <description>MS Graph message: Alert related events.</description>
    </rule>
    
    <rule id="99002" level="3">
        <if_sid>99000</if_sid>
        <options>no_full_log</options>
        <field name="relationship">incidents</field>
        <description>MS Graph message: Incident related events.</description>
    </rule>

    <rule id="99003" level="6">
        <if_sid>99001,99002</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.status" negate="yes">resolved</field>
        <field name="ms-graph.classification" negate="yes">falsePositive</field>
        <description>MS Graph message: The alert/incident has not been resolved and is not a false positive.</description>
    </rule>


<!--Alerts&Incidents/Unknowns 99006-99015-->

    <rule id="99006" level="4">
        <if_sid>99001</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.detectionSource">unknownFutureValue</field>
        <description>MS Graph message: Evolvable enumeration sentinel value. Unused value - Check for logging misconfigurations.</description>
    </rule>

    <rule id="99007" level="4">
        <if_sid>99001</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.serviceSource">unknownFutureValue</field>
        <description>MS Graph message: Evolvable enumeration sentinel value. Unused value - Check for logging misconfigurations.</description>
    </rule>

    <rule id="99008" level="4">
        <if_sid>99001,99002</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.classification">unknownFutureValue</field>
        <description>MS Graph message: Evolvable enumeration sentinel value. Unused value - Check for logging misconfigurations.</description>
    </rule>

    <rule id="99009" level="4">
        <if_sid>99001,99002</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">unknownFutureValue</field>
        <description>MS Graph message: Evolvable enumeration sentinel value. Unused value - Check for logging misconfigurations.</description>
    </rule>
    
    <rule id="99010" level="4">
        <if_sid>99001,99002</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.status">unknownFutureValue</field>
        <description>MS Graph message: Evolvable enumeration sentinel value. Unused value - Check for logging misconfigurations.</description>
    </rule>

    <rule id="99011" level="4">
        <if_sid>99001,99002</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.severity">unknownFutureValue</field>
        <description>MS Graph message: Evolvable enumeration sentinel value. Unused value - Check for logging misconfigurations.</description>
    </rule>

    <rule id="99012" level="6">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.severity">unknown</field>
        <description>MS Graph message: Unknown severity.</description>
    </rule>


<!--Alerts&Incidents/Severity 99016-99020-->

    <rule id="99016" level="6">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.severity">informational</field>
        <description>MS Graph message: Indicators suggesting potential security issues were detected, but they might not be actionable or harmful.</description>
    </rule>

    <rule id="99017" level="6">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.severity">low</field>
        <description>MS Graph message: Indicators associated with prevalent malware and common threats were detected.</description>
    </rule>

    <rule id="99018" level="12">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.severity">medium</field>
        <description>MS Graph message: Behaviors and indicators that might be a part of an advanced persistent threat (APT) were detected. This includes observed behaviors typical of attack stages, anomalous registry change, execution of suspicious files, and so forth.</description>
    </rule>

    <rule id="99019" level="15">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.severity">high</field>
        <description>MS Graph message: Behaviors and indicators that are commonly associated with advanced persistent threats (APT) activity were detected. There is a high risk of severe damage to affected assets. Requires immediate action.</description>
    </rule>


<!--Alerts&Incidents/Category 99021-99105-->

    <!--Informational-->

    <rule id="99021" level="3">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">General</field>
        <description>MS Graph message: A potential security issue has been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99022" level="6">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">CommandAndControl</field>
        <mitre>
            <id>TA0011</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is potentially communicating with a C2 server have been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99023" level="6">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Collection</field>
        <mitre>
            <id>TA0009</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is potentially performing data collection or data discovery have been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99024" level="6">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">CredentialAccess</field>
        <mitre>
            <id>TA0006</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is potentially involved in stealing credentials have been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99025" level="6">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">DefenseEvasion</field>
        <mitre>
            <id>TA0005</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is potentially performing defense evasion have been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99026" level="6">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Discovery</field>
        <mitre>
            <id>TA0007</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is potentially performing network discovery or account enumeration have been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99027" level="6">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Exfiltration</field>
        <mitre>
            <id>TA0010</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is potentially performing data exfiltration have been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99028" level="6">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Exploit</field>
        <mitre>
            <id>T1587.004</id>
        </mitre>
        <description>MS Graph message: Indicators of potential vulnerability exploitation on the system have been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99029" level="6">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Execution</field>
        <mitre>
            <id>TA0002</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is potentially performing malicious code execution have been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99030" level="3">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">InitialAccess</field>
        <mitre>
            <id>TA0001</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is potentially experiencing intrusion attempts have been detected. This alert is commonly caused by phishing emails. Check the system for signs of infection.</description>
    </rule>

    <rule id="99031" level="6">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">LateralMovement</field>
        <mitre>
            <id>TA0008</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is potentially establishing unauthorized internal connections have been detected. Check the systems for signs of infection.</description>
    </rule>

    <rule id="99032" level="12">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Malware</field>
        <mitre>
            <id>T1204.001</id>
            <id>T1204.002</id>
            <id>T1204.003</id>
            <id>T1587.001</id>
            <id>T1588.001</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is potentially infected with malware have been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99033" level="6">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Persistence</field>
        <mitre>
            <id>TA0003</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is potentially experiencing persistence establishment attempts have been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99034" level="6">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">PrivilegeEscalation</field>
        <mitre>
            <id>TA0004</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is potentially performing unauthorized permission elevation have been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99035" level="12">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Ransomware</field>
        <mitre>
            <id>T1486</id>
        </mitre>
        <description>MS Graph Message: Indicators that the system is potentially affected by ransomware have been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99036" level="6">
        <if_sid>99016</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">SuspiciousActivity</field>
        <description>MS Graph message: Potential suspicious activity has been detected. Check the system for signs of infection.</description>
    </rule>

    <!--Low-->

    <rule id="99042" level="6">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">General</field>
        <description>MS Graph message: A security issue has been detected. Check the system for signs of infection.</description>
    </rule>

    <rule id="99043" level="12">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">CommandAndControl</field>
        <mitre>
            <id>TA0011</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is communicating with a C2 server have been detected. This alert usually originates from common malware and threats, rather than APT activity. Check the system for signs of infection.</description>
    </rule>

    <rule id="99044" level="6">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Collection</field>
        <mitre>
            <id>TA0009</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing data collection or data discovery have been detected. This alert usually originates from common malware and threats, rather than APT activity. Check the system for signs of infection.</description>
    </rule>

    <rule id="99045" level="12">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">CredentialAccess</field>
        <mitre>
            <id>TA0006</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is involved in stealing credentials have been detected. This alert usually originates from common malware and threats, rather than APT activity. Check the system for signs of infection.</description>
    </rule>

    <rule id="99046" level="12">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">DefenseEvasion</field>
        <mitre>
            <id>TA0005</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing defense evasion have been detected. This alert usually originates from common malware and threats, rather than APT activity. Check the system for signs of infection.</description>
    </rule>

    <rule id="99047" level="6">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Discovery</field>
        <mitre>
            <id>TA0007</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing network discovery or account enumeration have been detected. This alert usually originates from common malware and threats, rather than APT activity. Check the system for signs of infection.</description>
    </rule>

    <rule id="99048" level="12">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Exfiltration</field>
        <mitre>
            <id>TA0010</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing data exfiltration have been detected. This alert usually originates from common malware and threats, rather than APT activity. Check the system for signs of infection.</description>
    </rule>

    <rule id="99049" level="12">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Exploit</field>
        <mitre>
            <id>T1587.004</id>
        </mitre>
        <description>MS Graph message: Indicators of vulnerability exploitation on the system have been detected. However, this alert is unlikely to indciate an APT. Check the system for signs of infection.</description>
    </rule>

    <rule id="99050" level="12">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Execution</field>
        <mitre>
            <id>TA0002</id>
        </mitre>        
        <description>MS Graph message: Indicators that the system is performing malicious code execution have been detected. However, this alert is unlikely to indciate an APT. Check the system for signs of infection.</description>
    </rule>

    <rule id="99051" level="6">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">InitialAccess</field>
        <mitre>
            <id>TA0001</id>
        </mitre>        
        <description>MS Graph message: Indicators that the system is affected by intrusion attempts have been detected. This alert usually originates from common malware and threats, rather than APT activity. Check the system for signs of infection.</description>
    </rule>

    <rule id="99052" level="12">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">LateralMovement</field>
        <mitre>
            <id>TA0008</id>
        </mitre>        
        <description>MS Graph message: Indicators that the system is establishing unauthorized internal connections have been detected. This alert usually originates from common malware and threats, rather than APT activity. Check the systems for signs of infection.</description>
    </rule>

    <rule id="99053" level="12">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Persistence</field>
        <mitre>
            <id>TA0003</id>
        </mitre>        
        <description>MS Graph message: Indicators that the system is affected by persistence establishment attempts have been detected. This alert usually originates from common malware and threats, rather than APT activity. Check the system for signs of infection.</description>
    </rule>

    <rule id="99054" level="12">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">PrivilegeEscalation</field>
        <mitre>
            <id>TA0004</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing unauthorized permission elevation have been detected. This alert usually originates from common malware and threats, rather than APT activity. Check the system for signs of infection.</description>
    </rule>

    <rule id="99055" level="12">
        <if_sid>99012,99017</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">SuspiciousActivity</field>
        <description>MS Graph message: Suspicious activity has been detected. This can range from log clearing to hack-tools being used. This alert usually originates from common malware and threats, rather than APT activity.</description>
    </rule>

    <!--Medium-->

    <rule id="99061" level="12">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">General</field>
        <description>MS Graph message: A significant security issue has been detected.</description>
    </rule>

    <rule id="99062" level="13">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">CommandAndControl</field>
        <mitre>
            <id>TA0011</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is communicating with a C2 server have been detected. This alert may be indicative of an APT.</description>
    </rule>

    <rule id="99063" level="13">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Collection</field>
        <mitre>
            <id>TA0009</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing data collection or data discovery have been detected. This alert may be indicative of an APT.</description>
    </rule>

    <rule id="99064" level="13">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">CredentialAccess</field>
        <mitre>
            <id>TA0006</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is involved in stealing credentials have been detected. This alert may be indicative of an APT.</description>
    </rule>

    <rule id="99065" level="13">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">DefenseEvasion</field>
        <mitre>
            <id>TA0005</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing defense evasion have been detected. This alert may be indicative of an APT.</description>
    </rule>

    <rule id="99066" level="12">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Discovery</field>
        <mitre>
            <id>TA0007</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing network discovery or account enumeration have been detected. This alert may be indicative of an APT.</description>
    </rule>

    <rule id="99067" level="13">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Exfiltration</field>
        <mitre>
            <id>TA0010</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing data exfiltration have been detected. This alert may be indicative of an APT.</description>
    </rule>

    <rule id="99068" level="13">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Exploit</field>
        <mitre>
            <id>T1587.004</id>
        </mitre>
        <description>MS Graph message: Indicators of vulnerability exploitation on the system have been detected. This alert may be indicative of an APT.</description>
    </rule>

    <rule id="99069" level="13">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Execution</field>
        <mitre>
            <id>TA0002</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing malicious code execution have been detected. This alert may be indicative of an APT.</description>
    </rule>

    <rule id="99070" level="12">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">InitialAccess</field>
        <mitre>
            <id>TA0001</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is affected by intrusion attempts have been detected. This alert may be indicative of an APT.</description>
    </rule>

    <rule id="99071" level="13">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">LateralMovement</field>
        <mitre>
            <id>TA0008</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is establishing unauthorized internal connections have been detected. This alert may be indicative of an APT.</description>
    </rule>

    <rule id="99072" level="13">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Persistence</field>
        <mitre>
            <id>TA0003</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is affected by persistence establishment attempts have been detected. This alert may be indicative of an APT.</description>
    </rule>

    <rule id="99073" level="13">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">PrivilegeEscalation</field>
        <mitre>
            <id>TA0004</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing unauthorized permission elevation have been detected. This alert may be indicative of an APT.</description>
    </rule>

    <rule id="99074" level="13">
        <if_sid>99018</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">SuspiciousActivity</field>
        <description>MS Graph message: Suspicious activity has been detected. This can range from log clearing to hack-tools being used. This alert may be indicative of an APT.</description>
    </rule>

    <!--High-->

    <rule id="99080" level="14">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">General</field>
        <description>MS Graph message: A critical security issue has been detected.</description>
    </rule>

    <rule id="99081" level="15">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">CommandAndControl</field>
        <mitre>
            <id>TA0011</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is communicating with a C2 server have been detected. This alert is very likely to indicate an APT.</description>
    </rule>

    <rule id="99082" level="15">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Collection</field>
        <mitre>
            <id>TA0009</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing data collection or data discovery have been detected. This alert is very likely to indicate an APT.</description>
    </rule>

    <rule id="99083" level="15">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">CredentialAccess</field>
        <mitre>
            <id>TA0006</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is involved in stealing credentials have been detected. This alert is very likely to indicate an APT.</description>
    </rule>

    <rule id="99084" level="14">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">DefenseEvasion</field>
        <mitre>
            <id>TA0005</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing defense evasion have been detected. This alert is very likely to indicate an APT.</description>
    </rule>

    <rule id="99085" level="14">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Discovery</field>
        <mitre>
            <id>TA0007</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing network discovery or account enumeration have been detected. This alert is very likely to indicate an APT.</description>
    </rule>

    <rule id="99086" level="15">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Exfiltration</field>
        <mitre>
            <id>TA0010</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing data exfiltration have been detected. This alert is very likely to indicate an APT.</description>
    </rule>

    <rule id="99087" level="15">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Exploit</field>
        <mitre>
            <id>T1587.004</id>
        </mitre>
        <description>MS Graph message: Indicators of vulnerability exploitation on the system have been detected. This alert is very likely to indicate an APT.</description>
    </rule>

    <rule id="99088" level="15">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Execution</field>
        <mitre>
            <id>TA0002</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing malicious code execution have been detected. This alert is very likely to indicate an APT.</description>
    </rule>

    <rule id="99089" level="14">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">InitialAccess</field>
        <mitre>
            <id>TA0001</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is affected by intrusion attempts have been detected. This alert is very likely to indicate an APT.</description>
    </rule>

    <rule id="99090" level="15">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">LateralMovement</field>
        <mitre>
            <id>TA0008</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is establishing unauthorized internal connections have been detected. This alert is very likely to indicate an APT.</description>
    </rule>

    <rule id="99091" level="15">
        <if_sid>99017,99018,99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Malware</field>
        <mitre>
            <id>T1204.001</id>
            <id>T1204.002</id>
            <id>T1204.003</id>
            <id>T1587.001</id>
            <id>T1588.001</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is infected with malware have been detected.</description>
    </rule>

    <rule id="99092" level="15">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Persistence</field>
        <mitre>
            <id>TA0003</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is affected by persistence establishment attempts have been detected. This alert is very likely to indicate an APT.</description>
    </rule>

    <rule id="99093" level="15">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">PrivilegeEscalation</field>
        <mitre>
            <id>TA0004</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is performing unauthorized permission elevation have been detected. This alert is very likely to indicate an APT.</description>
    </rule>

    <rule id="99094" level="15">
        <if_sid>99017,99018,99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">Ransomware</field>
        <mitre>
            <id>T1486</id>
        </mitre>
        <description>MS Graph message: Indicators that the system is infected with ransomware have been detected. Requires immediate action.</description>
    </rule>

    <rule id="99095" level="14">
        <if_sid>99019</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.category">SuspiciousActivity</field>
        <description>MS Graph message: Suspicious activity has been detected. This alert is very likely to be indicative of an APT.</description>
    </rule>


<!--Alerts&Incidents/Determination 99106-99130-->

    <rule id="99106" level="15">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">apt</field>
        <description>MS Graph message: An advanced persistent threat (APT) has been detected in the environment. This is a true positive alert. Requires immediate action.</description>
    </rule>

    <rule id="99107" level="15">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">malware</field>
        <mitre>
            <id>T1204.001</id>
            <id>T1204.002</id>
            <id>T1204.003</id>
            <id>T1587.001</id>
            <id>T1588.001</id>
        </mitre>
        <description>MS Graph message: Malware has been detected in the environment. This is a true positive alert.</description>
    </rule>

    <rule id="99108" level="6">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">securityPersonnel</field>
        <description>MS Graph message: Suspicious activity by someone in the security team has been detected. This is a true positive alert.</description>
    </rule>

    <rule id="99109" level="3">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">securityTesting</field>
        <description>MS Graph message: Suspicious activity that was performed as part of a known security testing has been detected.</description>
    </rule>

    <rule id="99110" level="12">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">unwantedSoftware</field>
        <description>MS Graph message: Unwanted software has been detected in the environment.</description>
    </rule>

    <rule id="99111" level="15">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">multiStagedAttack</field>
        <description>MS Graph message: An attack involving multiple kill-chain attack stages has been detected. This is a true positive alert.</description> 
    </rule>
    
    <rule id="99112" level="15">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">compromisedAccount</field>
        <mitre>
            <id>T1078</id>
            <id>T1586</id>
            <id>T1589.001</id>
            <id>TA0006</id>
        </mitre>
        <description>MS Graph message: A user's credentials were compromised or stolen. This is a true positive alert.</description>
    </rule>

    <rule id="99113" level="6">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">phishing</field>
        <mitre>
            <id>T1566</id>
        </mitre>
        <description>MS Graph message: A phishing email has been detected. This is a true positive alert.</description>
    </rule>

    <rule id="99114" level="15">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">maliciousUserActivity</field>
        <description>MS Graph message: A logged-on user performed malicious activities in the environment. This is a true positive alert.</description>
    </rule>

    <rule id="99115" level="3">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">notMalicious</field>
        <description>MS Graph message: A potentially false alert, no suspicious or malicious activity has been detected.</description>
    </rule>

    <rule id="99116" level="6">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">notEnoughDataToValidate</field>
        <description>MS Graph message: A potentially false alert, there isn't enough information to prove an attack took place.</description>
    </rule>

    <rule id="99117" level="6">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">confirmedActivity</field>
        <description>MS Graph message: Suspicious activity has been detected, but it is considered OK because it is a known user activity.</description>
    </rule>

    <rule id="99118" level="6">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">lineOfBusinessApplication</field>
        <description>MS Graph message: Suspicious activity has been detected, but it is considered OK because it is originating from a known and confirmed internal application.</description>
    </rule>

    <rule id="99119" level="12">
        <if_sid>99003</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.determination">other</field>
        <description>MS Graph message: Other determination.</description>
    </rule>


<!--Alerts&Incidents/Classification&Status 99131-99135-->

    <rule id="99131" level="3">
        <if_sid>99001,99002</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.classification">falsePositive</field>
        <description>MS Graph message: No malicious activity has been detected. This alert indicates a false positive.</description>
    </rule>
    
    <rule id="99132" level="6">
        <if_sid>99001,99002</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.classification">informationalExpectedActivity</field>
        <description>MS Graph message: Potentially malicious activity, such as security testing, by a trusted/internal user has been detected. This alert indicates a benign positive.</description>
    </rule>

    <rule id="99133" level="3">
        <if_sid>99001,99002</if_sid>
        <options>no_full_log</options>
        <field name="ms-graph.status">resolved</field>
        <description>MS Graph message: This indicates that the alert has been resolved.</description>
    </rule>


<!--End of Alerts&Incidents -->
</group>
